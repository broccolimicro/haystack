chan channel
{
	
	int r;
	int a;

	void send()
	{
		r+;[a];r-;[~a]
	}
	
	void recv()
	{
		[r];a+;[~r];a-
	}
	
	int probe()
	{
		[   r -> return 1;
		[] ~r -> return 0;
		]
	}
}

proc fifo(channel l, channel r)
{
	int<3> x;
	*[  x == 0 -> ([l.r -> skip]; l.a := 0b0100 <= 0b1100 ) || ([~l.r -> skip]; l.a := 0); x := 1
	 [] x == 1 -> r.a := 1 || [r.r -> skip] || r.a := 0 || [~r.r -> skip]; x := 0
	 ]
}

proc clean_fifo(channel l, channel r)
{
	*[1 -> [l.r -> skip] || l.a := 1; [~l.r -> skip] || l.a := 0; r.a := 1 || [r.r -> skip]; r.a := 0 || [~r.r -> skip]]
}

proc main()
{
	channel a;
	channel b;
	channel c;
	fifo f1(a, b);
	fifo f2(b, c);
}
