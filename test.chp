record channel
{
	int<4> a;
	int<4> r;
}

proc fifo(channel l, channel r)
{
	int<1> x; x := 0; [l.r -> skip]; l.a := 1; [~l.r -> skip]; x := l.r <= 1; l.a := 0; r.a := 1; [r.r -> skip]; r.a := 0; [~r.r -> skip]; x := 0; [l.r -> skip]; l.a := 1; [~l.r -> skip]; x := 1; l.a := 0; r.a := 1; [r.r -> skip]; r.a := 0; [~r.r -> skip]
}

proc clean_fifo(channel l, channel r)
{
	int<1> x; x := 0; [l.r -> skip]; l.a := 1; [~l.r -> skip]; x := 1; l.a := 0; r.a := 1; [r.r -> skip]; r.a := 0; [~r.r -> skip]; x := 0; [l.r -> skip]; l.a := 1; [~l.r -> skip]; x := 1; l.a := 0; r.a := 1; [r.r -> skip]; r.a := 0; [~r.r -> skip]
}

proc main()
{
	channel a;
	channel b;
	channel c;
	fifo f1(a, b);
	fifo f2(b, c);
}
